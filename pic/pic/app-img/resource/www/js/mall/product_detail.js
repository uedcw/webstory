$(function(){$(".detail").click(function(){var i=$(this);if(!i.hasClass("on")){var e=i.attr("content_id");i.parent().parent().find("li .detail").removeClass("on");i.addClass("on");var t=$("#"+e);$(".all_content").children().css("display","none");$("."+e).css("display","block")}});$(".do_num").on("click",function(){var i=$("#buy_num").val();if(i.isInteger()){i=parseFloat(i);var e={id:itemDetail.itemIn.id,purity:itemDetail.itemIn.purity,supplier_company_id:itemDetail.companyIn.supplier_company_id};var t=i+cart.getItemNum(e);if($(this).hasClass("add")){i=i+1}else if($(this).hasClass("reduce")){if(t>itemDetail.minQuantity&&i>1){i=i-1;if(i<itemDetail.minQuantity){$("#pay_but").addClass("disable")}else{$("#pay_but").removeClass("disable")}}else{return false}}$("#buy_num").val(i);setQuantity(0)}else{return false}});$(document).on("click",".purity_sel",function(){addOnClass(this,"on");itemDetail.defaultPurity=$(this).html();setPurity(1);if(itemDetail.is_pack!=1){setQuantity(0)}$("#detail_product_money").html(itemDetail.itemIn.price)});$("#buy_num").on("keyup",function(){setQuantity(0)});$("#buy_num").on("blur",function(){setQuantity(1)});$("#add_cart_but").click(function(){cart.setBuyType(0);setQuantity(0);if(!$(this).hasClass("disable")){cart.shopping(itemDetail.itemIn.id,itemDetail.itemIn.img,"add_cart_detail_but");if(!$(this).hasClass("disable")){var i=new Array;i=cloneObj(itemDetail.itemIn);cart.addItem({goods_price:i.goods_price,item:i,company:itemDetail.companyIn},itemDetail.priceIn[itemDetail.defaultPurity])}}});$("#pay_but").click(function(){if(!$(this).hasClass("disable")){setQuantity(0);cart.setBuyType(1);var i=new Array;i=cloneObj(itemDetail.itemIn);if(itemDetail.is_pack!=1){i.price=i.direct_buy_price;i.price_id=i.direct_buy_price_id;i.goods_price=i.direct_buy_goods_price}checkLogin(function(){cart.addBuyItem({goods_price:i.goods_price,item:i,company:itemDetail.companyIn},function(){location.href="http://"+mallDomain+"/order-step-2.html"})})}});$(".price_option").not(".not").click(function(){var i=$("#buy_num");$(".buy_but").removeClass("disable");addOnClass(this,"on");i.css("color","#000000");itemDetail.itemIn.price_id=$(this).attr("price_id");itemDetail.itemIn.price=$("#price_"+itemDetail.itemIn.price_id).html();var e=0;if(itemDetail.is_pack==1){e=i.val()}else{var t=$("#start_pack_num_"+itemDetail.itemIn.price_id).html();e=parseFloat(t)>=itemDetail.minQuantity?t:itemDetail.minQuantity;i.val(e)}$("#detail_product_money").html(itemDetail.itemIn.price);itemDetail.itemIn.quantity=e;setAllMoney()});itemDetail.itemIn.quantity=$("#buy_num").val();itemDetail.itemIn.price_id=$(".price_option.on").attr("price_id");itemDetail.itemIn.price=$("#price_"+itemDetail.itemIn.price_id).html()});function setPurity(i){var e=itemDetail.defaultPurity.replace("%","");e=e.replace(".","");$(".price_option").css("display","none");$(".price_option_"+e).css("display","");if(itemDetail.itemIn.price==0||i==1){var t=$(".price_option_"+e+":eq(0)");itemDetail.itemIn.price_id=t.attr("price_id");addOnClass(t,"on");itemDetail.itemIn.price=$("#price_"+itemDetail.itemIn.price_id).html()}itemDetail.itemIn.purity=itemDetail.defaultPurity}function setQuantity(i){var e=$("#buy_num");var t=e.val();var a=$(".add_cart_detail_but");if(t.isInteger()&&t>0){t=parseFloat(t);$(".add_cart_detail_but").removeClass("disable");if(t<itemDetail.minQuantity){$("#pay_but").addClass("disable")}else{$("#pay_but").removeClass("disable")}var l=0;var n={id:itemDetail.itemIn.id,purity:itemDetail.itemIn.purity,supplier_company_id:itemDetail.companyIn.supplier_company_id};l=t+cart.getItemNum(n);if(l<itemDetail.minQuantity){e.css("color","#F00000");a.addClass("disable");if(i==1){e.val(itemDetail.minQuantity);e.css("color","#000000");a.removeClass("disable");dialog.error("购买数不能小于"+itemDetail.minQuantity+itemDetail.minUnit+"！",function(){$("#pay_but").removeClass("disable");a.focus()})}return false}else{a.removeClass("disable");$("#buy_num").css("color","#000000");if(itemDetail.is_pack==1){if(itemDetail.itemIn.defaultPurity!=""){setPurity();$("#detail_product_money").html(itemDetail.itemIn.price)}else{$(".purity_sel:eq(0)").click()}}else{var r=getNewPrice(itemDetail.priceIn[itemDetail.defaultPurity],t);addOnClass("price_form_"+r["id"],"on");$("#detail_product_money").html(r[priceType]);itemDetail.itemIn.direct_buy_price=r[priceType];itemDetail.itemIn.direct_buy_price_id=r["id"];var m=getNewPrice(itemDetail.priceIn[itemDetail.defaultPurity],l);itemDetail.itemIn.price=m[priceType];itemDetail.itemIn.price_id=m["id"]}itemDetail.itemIn.quantity=t;setAllMoney()}}else{a.addClass("disable");e.css("color","#F00000");if(i==1){e.val(itemDetail.minQuantity);e.css("color","#000000");a.removeClass("disable");dialog.error("购买数量必须为大于0的数字！",function(){$("#pay_but").removeClass("disable");a.focus()})}}}function setAllMoney(){itemDetail.itemIn.direct_buy_goods_price=parseFloat(itemDetail.itemIn.quantity)*parseFloat(itemDetail.itemIn.direct_buy_price);itemDetail.itemIn.goods_price=parseFloat(itemDetail.itemIn.quantity)*parseFloat(itemDetail.itemIn.price)}