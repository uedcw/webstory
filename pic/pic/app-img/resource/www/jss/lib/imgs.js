define([],function(){function e(e,t,n,r){var i=0,s=0;return e>0&&t>0&&(e/t>=n/r?e>n?(i=n,s=t*n/e):(i=e,s=t):t>r?(s=r,i=e*r/t):(i=e,s=t)),{width:parseInt(i,10),height:parseInt(s,10)}}var t=function(){var e=[],t=null,n=function(){var t=0;for(;t<e.length;t++)e[t].end?e.splice(t--,1):e[t]();!e.length&&r()},r=function(){clearInterval(t),t=null};return function(r,i,s,o){var u,a,f,l,c,h=new Image;h.src=r;if(h.complete){i.call(h),s&&s.call(h);return}a=h.width,f=h.height,h.onerror=function(){o&&o.call(h),u.end=!0,h=h.onload=h.onerror=null},u=function(){l=h.width,c=h.height;if(l!==a||c!==f||l*c>1024)i.call(h),u.end=!0},u(),h.onload=function(){!u.end&&u(),s&&s.call(h),h=h.onload=h.onerror=null},u.end||(e.push(u),t===null&&(t=setInterval(n,40)))}}();return{zoom:e,ready:t}});