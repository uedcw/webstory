define(["module","jquery","malldialog","cart","style"],function(e,t,n,r,i){function s(e){var i=t("#dialog_buy_num"),s=i.val(),a=t("#add_cart_dialog_but");if(s.isInteger()&&s>0){s=parseFloat(s),a.removeClass("disable");var f={id:dialogItemDetail.itemIn.id,purity:dialogItemDetail.itemIn.purity,supplier_company_id:dialogItemDetail.companyIn.supplier_company_id},l=s+r.instance.getItemNum(f);if(l<parseFloat(dialogItemDetail.minQuantity))return i.css("color","#F00000"),a.addClass("disable"),e==1&&(i.val(dialogItemDetail.minQuantity),i.css("color","#000000"),a.removeClass("disable"),n.error("购买数不能小于"+dialogItemDetail.minQuantity+dialogItemDetail.minUnit+"！",function(){t("#pay_but").removeClass("disable"),a.focus()})),!1;a.removeClass("disable"),t("#buy_num").css("color","#000000");if(dialogItemDetail.is_pack==1)dialogItemDetail.itemIn.defaultPurity!=""?(u(),t("#dialog_item_money").html(dialogItemDetail.itemIn.price)):t(".dialog_purity_sel:eq(0)").click();else{var c=r.doCart.getNewPrice(dialogItemDetail.priceIn[dialogItemDetail.showLevel][dialogItemDetail.defaultPurity],s);style.addOnClass("dialog_price_form_"+c.id,"on"),t("#dialog_item_money").html(c[priceType]),dialogItemDetail.itemIn.direct_buy_price=c[priceType],dialogItemDetail.itemIn.direct_buy_price_id=c.id;var h=r.doCart.getNewPrice(dialogItemDetail.priceIn[dialogItemDetail.showLevel][dialogItemDetail.defaultPurity],l);dialogItemDetail.itemIn.price=h[priceType],dialogItemDetail.itemIn.price_id=h.id}dialogItemDetail.itemIn.quantity=s,o()}else a.addClass("disable"),i.css("color","#F00000"),e==1&&(i.val(dialogItemDetail.minQuantity),i.css("color","#000000"),a.removeClass("disable"),n.error("购买数量必须为大于0的数字！",function(){t("#pay_but").removeClass("disable"),a.focus()}))}function o(){dialogItemDetail.itemIn.goods_price=parseFloat(dialogItemDetail.itemIn.quantity)*parseFloat(dialogItemDetail.itemIn.price)}function u(e){var n=dialogItemDetail.defaultPurity.replace("%","");n=n.replace(".",""),t(".dialog_price_option").css("display","none"),t(".dialog_price_option_"+n).css("display","");if(dialogItemDetail.itemIn.price==0||e==1){var r=t(".dialog_price_option_"+n+":eq(0)");dialogItemDetail.itemIn.price_id=r.attr("price_id"),style.addOnClass(r,"on"),dialogItemDetail.itemIn.price=t("#dialog_price_"+dialogItemDetail.itemIn.price_id).html()}else if(dialogItemDetail.itemIn.price_id>0)style.addOnClass(t("#dialog_price_form_"+dialogItemDetail.itemIn.price_id),"on");else{var i=t(".dialog_price_option.on").attr("price_id");typeof i!="undefined"&&(dialogItemDetail.itemIn.price_id=i,dialogItemDetail.itemIn.price=t("#dialog_price_"+dialogItemDetail.itemIn.price_id).html())}dialogItemDetail.is_pack==1,dialogItemDetail.itemIn.purity=dialogItemDetail.defaultPurity}r.instance.setBuyType(0),s(0),t(document).on("keyup","#dialog_buy_num",function(){s(0)}),t(document).on("blur","#dialog_buy_num",function(){s(1)}),t(document).on("click",".dialog_purity_sel",function(){style.addOnClass(this,"on"),dialogItemDetail.defaultPurity=t(this).html(),u(1),t("#dialog_item_money").html(dialogItemDetail.itemIn.price),dialogItemDetail.is_pack!=1&&s(0)}),t(document).on("click",".do_dialog_num",function(){var e=t("#dialog_buy_num"),n=e.val();if(!n.isInteger())return!1;n=parseFloat(n);var i={id:dialogItemDetail.itemIn.id,purity:dialogItemDetail.itemIn.purity,supplier_company_id:dialogItemDetail.companyIn.supplier_company_id},o=n+r.instance.getItemNum(i);if(t(this).hasClass("add"))n+=1;else if(t(this).hasClass("reduce")){if(!(o>dialogItemDetail.minQuantity&&n>1))return!1;n-=1}e.val(n),s(0)}),t(document).on("click","#add_cart_dialog_but",function(){s(0);if(!t(this).hasClass("disable")){r.instance.shopping(dialogItemDetail.itemIn.id,dialogItemDetail.itemIn.img,"cart_item_"+dialogItemDetail.itemIn.id);if(!t(this).hasClass("disable")){n.closeBox();var e=new Array;e=cloneObj(dialogItemDetail.itemIn),r.instance.addItem({goods_price:e.goods_price,item:e,level:dialogItemDetail.showLevel,company:dialogItemDetail.companyIn},dialogItemDetail.priceIn[dialogItemDetail.showLevel][dialogItemDetail.defaultPurity])}}}),t(document).on("click",".dialog_price_option",function(){var e=t("#dialog_buy_num"),n=t("#add_cart_dialog_but");n.removeClass("disable"),style.addOnClass(this,"on"),e.css("color","#000000"),dialogItemDetail.itemIn.price_id=t(this).attr("price_id"),dialogItemDetail.itemIn.price=t("#dialog_price_"+dialogItemDetail.itemIn.price_id).html();var r=0;if(dialogItemDetail.is_pack==1)r=e.val();else{var i=t("#dialog_start_pack_num_"+dialogItemDetail.itemIn.price_id).html();r=parseFloat(i)>=parseFloat(dialogItemDetail.minQuantity)?i:dialogItemDetail.minQuantity,e.val(r)}t("#dialog_item_money").html(dialogItemDetail.itemIn.price),dialogItemDetail.itemIn.quantity=r,o()}),dialogBuyQuantity=t("#dialog_buy_text").val(),dialogPriceId=t(".dialog_price_option.on").attr("price_id"),dialogPrice=t("#dialog_price_"+dialogPriceId).html()});