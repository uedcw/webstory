define(["jquery"],function(e){var t=e(window),n=e(document),r="createTouch"in document,i=document.documentElement,s=!("minWidth"in i.style),o=!s&&"onlosecapture"in i,u="setCapture"in i,a={start:r?"touchstart":"mousedown",over:r?"touchmove":"mousemove",end:r?"touchend":"mouseup"},f=r?function(e){return e.touches||(e=e.originalEvent.touches.item(0)),e}:function(e){return e},l=function(){this.start=e.proxy(this.start,this),this.over=e.proxy(this.over,this),this.end=e.proxy(this.end,this),this.onstart=this.onover=this.onend=e.noop};return l.types=a,l.prototype={start:function(e){return e=this.startFix(e),n.on(a.over,this.over).on(a.end,this.end),this.onstart(e),!1},over:function(e){return e=this.overFix(e),this.onover(e),!1},end:function(e){return e=this.endFix(e),n.off(a.over,this.over).off(a.end,this.end),this.onend(e),!1},startFix:function(r){return r=f(r),this.target=e(r.target),this.selectstart=function(){return!1},n.on("selectstart",this.selectstart).on("dblclick",this.end),o?this.target.on("losecapture",this.end):t.on("blur",this.end),u&&this.target[0].setCapture(),r},overFix:function(e){return e=f(e),e},endFix:function(e){return e=f(e),n.off("selectstart",this.selectstart).off("dblclick",this.end),o?this.target.off("losecapture",this.end):t.off("blur",this.end),u&&this.target[0].releaseCapture(),e}},l.create=function(r,i){var s=e(r),o=new l,u=l.types.start,a=function(){},f=r.className.replace(/^\s|\s.*/g,"")+"-drag-start",c,h,p,d,v={onstart:a,onover:a,onend:a,off:function(){s.off(u,o.start)}};return o.onstart=function(e){var i=s.css("position")==="fixed",o=n.scrollLeft(),u=n.scrollTop(),a=s.width(),l=s.height();c=0,h=0,p=i?t.width()-a+c:n.width()-a,d=i?t.height()-l+h:n.height()-l;var m=s.offset(),g=this.startLeft=i?m.left-o:m.left,y=this.startTop=i?m.top-u:m.top;this.clientX=e.clientX,this.clientY=e.clientY,s.addClass(f),v.onstart.call(r,e,g,y)},o.onover=function(e){var t=e.clientX-this.clientX+this.startLeft,n=e.clientY-this.clientY+this.startTop,i=s[0].style;t=Math.max(c,Math.min(p,t)),n=Math.max(h,Math.min(d,n)),i.left=t+"px",i.top=n+"px",v.onover.call(r,e,t,n)},o.onend=function(e){var t=s.position(),n=t.left,i=t.top;s.removeClass(f),v.onend.call(r,e,n,i)},o.off=function(){s.off(u,o.start)},i?o.start(i):s.on(u,o.start),v},l});