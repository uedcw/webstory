define(["module","jquery","message"],function(e,t,n){function s(e){try{var i=e.data.init}catch(s){var i=t.noop()}try{var o=e.data.cfun}catch(s){var o=t.noop()}try{var u=e.data.wfun}catch(s){var u=t.noop()}var a="users_login_form";n.win(a,function(){var e=this,n=t("#"+a),s=t("#win_user_login_captcha_rs"),u=t("#win_user_login_captcha");t("s.tps","#"+a).hide(),i(),n.data("bind")||(n.data("bind",1),s.on("click",function(){u.attr("src",function(e,n){return n.replace(/t=\d+$/,"t="+t.now())}),t("[name='captcha']","#"+a).focus()}),t("#forms_"+a).submit(function(){t("s.tps","#"+a).hide();var e=t.trim(t("#tips_"+a).val()).split("|$|"),n=t("[name='user_name']","#"+a),r=t.trim(n.val());if(r=="")return n.next(".tps").text(e[1]).show(),n.focus(),!1;var i=t("[name='password']","#"+a),u=t.trim(i.val());if(u=="")return i.next(".tps").text(e[2]).show(),i.focus(),!1;var f=t("[name='captcha']","#"+a),l=t.trim(f.val());if(l=="")return f.nextAll(".tps").text(e[3]).show(),f.focus(),!1;var c={user_name:r,password:u,captcha:l,reqtype:"ajax"};return t.post("/index.php?app=member&act=login",c,function(t){if(!t.done){var n=t.msg;f.val(""),s.click();if(n==="auth_failed")return i.next(".tps").text(e[4]).show(),i.focus(),!1;if(n==="captcha_failed")return f.nextAll(".tps").text(e[5]).show(),!1}else o(t.retval)},"json"),!1})),e.title(r==="en"?"User Login":"用户登录"),n.find(":input").each(function(){var e=t(this);if(!e.prop("readonly")&&e.val()=="")return e.focus(),!1})},u)}var r=window.DB.leng,i=n.dialog;return{open:s}});