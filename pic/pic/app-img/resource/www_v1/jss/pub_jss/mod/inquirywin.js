define(["module","jquery","message","loginwin","inquiryckmail"],function(e,t,n,r,i){function g(e){if(typeof ga=="undefined")return;var t="";if(e==="d1")t="/js/cas_search/inquiry";else if(e==="d2")t="/js/cas_search/price_inquiry";else if(e==="d3")t="/js/txt_search/inquiry";else if(e==="d4")t="/js/txt_search/price_inquiry";else if(e==="d5")t="/js/batch_search/all_inquiry";else if(e==="d6")t="/js/batch_search/inquiry";else if(e==="d7")t="/js/txt_search/price_inquiry_price";else{if(e!=="d8")return;t="/js/txt_search/price_inquiry"}try{ga("send","pageview","/"+o+t)}catch(n){}}function y(){var e=t(this),r=d=e.hasClass("buts-bt1");e.hasClass("jg")&&e.is("a")&&(r=d=!0);var i=e.data("itemid");if(a!=="batch"&&!t("#one_inquiry_but_"+i).length)return;var o=e.data("rid"),c=e.data("arjg").toInt(),v=typeof e.attr("data-price")!="undefined";if(a=="view"){var y=t("#one_inquiry_but_"+i);if(!y.length||y.prop("disabled"))return;r?g("d2"):g(v?"d7":"d1")}else if(a=="goods")if(r)g("d4");else{var y=t("#one_inquiry_but_"+i);if(!y.length||y.prop("disabled"))return;g(v?"d8":"d3")}else a=="batch"&&g("d6");n.win(m,function(){var n=this,a=t("#"+m);n.title(d?l:f);if(p!==i){t("s.tps","#"+m).hide();var v=INQUIRY_PG_DATA["_jd_"+i],g=0,y=[],b="";t.each(v,function(e,t){var n=t.goods_id,i=[n,t.store_id,t.goods_mol_id,t.casrn].join(","),s="iracb_g_"+n,o="",u="",a="";g||(b=t.purity,o="",u=r?"":' disabled="disabled"',a=' checked="checked"'),y.push("<li"+o+' style="font-size:15px;"><input class="iracb" type="checkbox" id="'+s+'" name="order_gids" value="'+i+'"'+a+u+' /><label for="'+s+'">'+t.store_name+"</label></li>"),g++}),a.data("bind")||(a.data("bind",1),t("#close_"+m).on("click",function(){s.get(m+"_win").remove()}),t("#supplierlists_"+m).on("change",":checkbox",function(){t("#supplierlists_"+m).find(":checkbox:checked").length?t("#submit_"+m).prop("disabled",!1).removeClass("d"):t("#submit_"+m).prop("disabled",!0).addClass("d")}),t("#forms_"+m).submit(w)),login_user_email&&t("[name='order_from']","#"+m).val(login_user_email).addClass("d"),login_company_name&&t("[name='order_company']","#"+m).val(login_company_name).addClass("d"),login_link_man&&t("[name='link_man']","#"+m).val(login_link_man),login_link_tel&&t("[name='link_tel']","#"+m).val(login_link_tel),t("[name='order_purity']","#"+m).val(b);try{var E=t.trim(v[0].casrn)}catch(S){var E=t.trim(t("#listcas_"+o).text())}E=E?" ("+E+")":"";var x=t.trim(t("#listnam_"+o).text());t("[name='order_product']","#"+m).val(x.leftB(37,1)+E).addClass("d"),t("#supplierlists_"+m).empty().append(y.join("")),g>1?a.find(".valigntop").attr("valign","top"):(a.find(".buts_win_more").hide(),a.find(".valigntop").attr("valign","middle")),r&&(a.find(".buts_win_more").click(),t("#supplierlists_"+m).find(":checkbox").prop("checked",!0)),a.find(":input.d").prop("readonly",!0),p=i}t("[name='order_price']","#"+m).val("");var T=t.trim(e.data("num")),N=t.trim(e.data("unit")),C=t.trim(e.data("price"));T&&t("[name='order_quantity']","#"+m).val(T),N&&t("[name='order_quantity_unit']","#"+m).val(N);if(C)t("[name='order_price']","#"+m).val(C),t(".price_win_add_order_form").show();else{t(".price_win_add_order_form").hide();if(typeof e.attr("data-price")=="undefined"){var k=h?login_reference_price[o]:login_reference_price;if(t.isArray(k)&&k.length){try{var L=t("#reference_price_select_"+o).val().toInt()}catch(S){var L=0}var A=k[c][L],O=A.split("/")[1];O=O.replace(O.replace(/[μg|mg|g|kg|ton|μl|ml|l|u|ku|iu]/ig,""),""),t("[name='order_price']","#"+m).val(A),t("[name='order_quantity_unit']","#"+m).val(O.toLowerCase()),t(".price_win_add_order_form").show()}else t(".price_win_add_order_form").hide()}}if(u=="batchsearch"){var M=t("#table_tr_"+o),_=M.find(".item_set_num").val(),D=M.find(".item_set_num_unit").val(),P=M.find(".item_set_purity").val(),H=t.trim(M.find(".item_set_price").val());t("[name='order_quantity']","#"+m).val(_),t("[name='order_quantity_unit']","#"+m).val(D),t("[name='order_purity']","#"+m).val(P=="other"?"":P),H&&(t("[name='order_price']","#"+m).val(H),t(".price_win_add_order_form").show())}t("#submit_"+m).prop("disabled",!1).removeClass("d"),a.find(":text").each(function(){var e=t(this);if(!e.prop("readonly"))return e.focus(),!1})},function(){var e=t.trim(t(':checkbox[name="order_gids"]:first').val()).split(",")[0];t.post("./index.php?app=search&act=add_recently",{goods_id:e},function(e){})})}function b(e,r){if(r){var i=d?"quick_reference_price_ok":"order_buying_ok",o="/?app=order&act="+i+"&tps=iframe&buy_email="+login_user_email;t("#google_ga_iframe").attr("src",o);try{s.get(m+"_win").remove()}catch(u){}}p>0&&t("#one_inquiry_but_"+p).addClass(h?"d":"buts-xd-d").attr("title",c).prop("disabled",!0);var a="win_add_order_form_done";e.msg==="EMAIL_VERIFY"&&(a="win_add_order_form_done2"),n.win(a,function(){var n=this;t("#close_"+a).on("click",function(){s.get(a+"_win").remove()});try{t("#url_"+a).attr("href",function(t,n){return n.replace("##I##",e.retval[0]).replace("##T##",1)}),t("#burl_"+a).attr("data-burl",function(e,t){return t+"1"})}catch(r){}n.title(d?l:f)},function(){window.location.reload()})}function w(){t("s.tps","#"+m).hide();var e=t("[name='order_from']","#"+m),i=t.trim(e.val()),o=t("[name='order_company']","#"+m),u=t.trim(o.val()),a=t("[name='order_quantity']","#"+m),c=t.trim(a.val()).toInt(),h=t("[name='order_purity']","#"+m),p=t.trim(h.val()).toInt(),v=t.trim(t("#tips_"+m).val()).split("|$|");if(!login_user_email){if(i=="")return e.next(".tps").text(v[1]).show(),e.focus(),!1;if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(i))return e.next(".tps").text(v[2]).show(),e.focus(),!1}if(!login_company_name&&u=="")return o.next(".tps").text(v[3]).show(),o.focus(),!1;if(c<1)return a.nextAll(".tps").text(v[4]).show(),a.focus(),!1;if(p<1||p>100)return h.nextAll(".tps").text(v[6]).show(),h.focus(),!1;var g=t("[name='link_man']","#"+m),y=t.trim(g.val()),E=t("[name='link_tel']","#"+m),S=t.trim(E.val()),x=t.trim(t("[name='order_product']","#win_add_order_form").val()),T=t.trim(t("[name='order_quantity_unit']","#win_add_order_form").val()),p=t.trim(t("[name='order_purity']","#win_add_order_form").val()),N=t.trim(t("[name='order_price']","#win_add_order_form").val()),C=t.trim(t("[name='order_outers']","#win_add_order_form").val()),k=t.trim(t("[name='order_valid_day']:checked","#win_add_order_form").val()).toInt(),L=t("[name='order_authorize']:checked","#win_add_order_form").length,A=[];t(":checkbox[name='order_gids']","#win_add_order_form").each(function(e,n){t(this).is(":checked")&&A.push(this.value)});var O={order_from:i,order_company:u,order_product:x,order_quantity:c,order_quantity_unit:T,order_purity:p,order_price:N,order_outers:C,order_valid_day:k,order_authorize:L,order_gids:A,link_man:y,link_tel:S};return t("#submit_"+m).prop("disabled",!0).addClass("d"),t.post("/?app=order&act=proposelist",O,function(u){if(!u.done){try{s.get(m+"_win").remove()}catch(a){}if(u.msg==="no_login"){r.open({data:{cfun:function(t){login_user_email=t.email,login_company_name=t.company,e.val(login_user_email),o.val(login_company_name),w(),s.get("users_login_form_win").remove(),s.get("win_add_order_form_win").remove()},wfun:function(){t("#submit_users_login_form").prop("disabled",!1).removeClass("d")},init:function(){t("[name='user_name']","#users_login_form").val(i)}}});return}if(u.msg==="more_than_six"){var c="win_add_order_form_done1";n.win(c,function(){var e=this;t("#close_"+c).on("click",function(){s.get(c+"_win").remove()}),t("#msg_win_add_order_form_done1").html(u.retval[0]),e.title(d?l:f)},function(){window.location.reload()});return}if(u.msg==="company_repeat"){var c="win_add_order_form_err";n.win(c,function(){var e=this;t("#close_"+c).on("click",function(){s.get(c+"_win").remove()}),t("#msg_win_add_order_form_err").html(u.retval[0]),e.title(d?l:f)},function(){window.location.reload()});return}u.msg==="FAILED"&&b(u,0)}else b(u,1)},"json"),!1}var s=n.dialog,o=window.DB.leng,u=window.DB.page.app,a=function(){var e=window.DB.page.acc;if(t("#top_main_goods_span").length)return"goods";if(e==="search-index"||e==="moldata_information-view")return"view";if(e==="batchsearch-index")return"batch"}();if(o==="en")var f="Inquiry with Reference Price",l="Inquiry with Reference Price",c="For the selected product with the same supplier, you can only Inquiry ONCE within a day";else var f="参考价询单",l="参考价询单",c="对同一个供应商的同一个产品，您一天内只可以询单一次";var h=0,p=-1,d=0,v=0,m="win_add_order_form";return"store-index,store-search,store-topsell,search-search_big_goods".inc(window.DB.page.acc)&&(h=1),t("#top_main_goods_span").length&&(h=1),{open:y}});